= Data flow management(데이터 흐름 관리 )

IoT 서비스에서 **수집/전달/처리/저장/출력**의 단계로 나누어 데이터를 관리하는 구조는 **데이터 흐름**을 일관성 있게 유지하고, **확장성**과 **유연성**을 높이는 데 효과적입니다. 이 중에서 **전달**은 서비스 구성 요소 간 데이터를 안전하고 신속하게 전달하여 **실시간 모니터링** 및 **처리**가 가능하도록 하는 중요한 단계입니다. **Pub/Sub 메시지 전달 모델**을 활용하면 데이터를 필요로 하는 구성 요소가 구독하여 실시간으로 데이터를 수신하므로, **비동기식 통신**과 **확장성**이 용이합니다.

아래는 IoT 서비스의 구성 요소 간 데이터 **전달 단계**에서 **Pub/Sub 모델**과 **Mosquitto, RabbitMQ, Kafka** 등의 오픈 소스 소프트웨어를 중심으로 설명한 내용입니다.

---

== 1. Pub/Sub 메시지 전달 모델의 개요

**Pub/Sub**(Publish/Subscribe) 메시지 전달 모델은 **발행자(Publisher)**와 **구독자(Subscriber)**로 구성됩니다. 발행자는 특정 **토픽(Topic)**으로 메시지를 발행하고, 구독자는 해당 토픽을 구독하여 **필요한 데이터만 수신**하는 방식입니다. 이를 통해 데이터를 필요로 하는 구성 요소가 실시간으로 데이터를 받아보고, **비동기적으로 처리**할 수 있습니다.

=== 1.1 Pub/Sub 모델의 장점
* **확장성**: 여러 구성 요소가 동일한 데이터 소스를 구독하거나 발행할 수 있어 **확장성**이 우수합니다.
* **유연한 데이터 흐름 관리**: 특정 데이터에만 접근이 필요한 구성 요소가 해당 데이터만 구독할 수 있어 **데이터 전달 효율**이 높아집니다.
* **비동기 통신**: 데이터를 보내고 받을 때 동기화 상태가 필요하지 않아 시스템의 응답성과 유연성이 향상됩니다.

== 2. IoT 데이터 전달을 위한 오픈 소스 소프트웨어

각 소프트웨어는 **Pub/Sub 모델**을 사용하여 **발행된 데이터를 구독자에게 전달**하고, IoT 시스템의 구성 요소가 필요한 데이터에 접근할 수 있도록 지원합니다. **Mosquitto, RabbitMQ, Kafka**는 각기 다른 특성을 가지고 있으며, IoT 시스템의 요구 사항에 따라 선택할 수 있습니다.

=== 2.1 Mosquitto (MQTT Broker)

Mosquitto는 **경량의 MQTT 브로커**로, **저전력 디바이스** 및 **네트워크 대역폭**이 제한적인 환경에 적합합니다. MQTT는 **Pub/Sub 기반 메시징 프로토콜**로, 메시지를 **토픽**을 통해 전송하여 구성 요소들이 실시간으로 데이터를 구독할 수 있게 합니다.

* **특징**: 경량 프로토콜로 대역폭 절약이 가능하며, 센서 데이터 수집 및 IoT 디바이스 간 통신에 최적화.
* **적용 예시**: 환경 센서의 데이터를 수집하여 실시간 모니터링 시스템에 전송하는 데 활용. 예를 들어, **/farm1/greenhouse1/temperature** 토픽으로 온도 데이터를 발행하여 구독자가 데이터를 모니터링.

=== 2.2 RabbitMQ (AMQP Protocol Broker)

RabbitMQ는 **AMQP**(Advanced Message Queuing Protocol)를 사용하는 **메시지 브로커**로, **복잡한 라우팅 규칙**을 설정할 수 있어 IoT 시스템에서 **다양한 형태의 데이터 흐름**을 구성할 수 있습니다. **큐(queue)** 기반의 메시지 전달 방식과 **Pub/Sub 모델**을 혼합하여 사용할 수 있습니다.

* **특징**: 라우팅과 메시지 관리가 용이하여, 복잡한 데이터 흐름과 다양한 구독 조건을 지원합니다.
* **적용 예시**: 공장 내 다양한 센서 데이터를 각기 다른 구독 조건에 맞춰 전달하는 경우. 예를 들어, 특정 공정의 온도와 습도 데이터만 특정 모듈에서 구독할 수 있도록 구독 규칙을 설정.

=== 2.3 Kafka (Distributed Streaming Platform)

Kafka는 **대규모 데이터 스트리밍**을 위한 **분산 메시징 플랫폼**으로, 실시간 데이터 분석과 처리에 특화되어 있습니다. 높은 **처리량**과 **내구성**을 갖춘 **이벤트 스트리밍**을 지원하여, 많은 양의 데이터를 **실시간으로 전송**하고 처리할 수 있습니다.

* **특징**: 실시간 스트리밍 분석과 데이터 파이프라인 구축에 적합하며, 고속 데이터 처리를 위한 분산 환경을 지원.
* **적용 예시**: 스마트 시티에서 수집되는 대규모 데이터를 실시간으로 분석 시스템에 전송하여 이상 상태를 감지. 예를 들어, **/city1/traffic/vehicle_count** 토픽으로 교통량 데이터를 전송하여 실시간 분석.

== 3. IoT 데이터 전달에서의 구성 요소 역할

**collector**는 다양한 센서나 디바이스의 데이터를 수집한 후 **토픽을 설정**하여 발행하며, 각 data processing 모듈은 구독을 통해 데이터를 수신하고 처리합니다.

1. collector 역할
** 각 센서에서 수집된 데이터를 **토픽**을 기반으로 구분하여 발행.
** 예를 들어, 온도 센서에서 수집된 데이터는 **/factory1/lineA/temp_sensor/temperature**와 같이 정의된 토픽으로 MQTT 브로커(Mosquitto)로 발행.

2. Data Processing Module의 구독
** **Node-RED**: 시각화와 간단한 처리 작업을 수행할 때 사용되며, 특정 데이터만 구독하여 실시간 모니터링에 활용.
** **Telegraf**: 데이터 전처리와 집계 작업에 활용되며, 복합적인 데이터 분석이 필요한 경우 Kafka와 같은 대규모 메시지 브로커를 통해 데이터를 구독.
** **NiFi**: 복잡한 데이터 흐름을 구성할 때 RabbitMQ와 연동하여 조건에 따라 데이터를 필터링 및 변환하여 구독.

== 4. IoT 데이터 전달 구조의 장점

이처럼 **Pub/Sub 메시지 전달 모델**과 **오픈 소스 메시지 브로커**를 활용하여 IoT 데이터를 전달하면, IoT 서비스 구성 요소 간의 데이터 흐름이 **유연**하고 **확장성** 있게 유지됩니다.

* **효율적인 데이터 관리**: 특정 구성 요소가 필요로 하는 데이터만 구독함으로써 네트워크 부하를 줄이고, 데이터 전송 효율을 높임.
* **실시간 데이터 처리**: 메시지 브로커를 통해 데이터를 실시간으로 전송하여, 모니터링 및 이상 상태 감지가 가능.
* **확장성 및 유연성**: 필요에 따라 새로운 구성 요소를 쉽게 추가할 수 있으며, 기존 구성 요소에 영향을 미치지 않음.

== 5. 정리

* 이와 같은 구조는 IoT 서비스에서 수집된 데이터가 **collector**에서 **data processing** 모듈로 전달되는 동안 **일관성**과 **효율성**을 유지하여, 시스템이 안정적으로 운영될 수 있게 합니다.

---

[cols="1a,1a,1a",grid=none,frame=none]
|===
<s|
^s|link:../../README.md[목차]
>s|
|===