= InfluxDB를 활용한 데이터 저장

**InfluxDB**는 주로 시계열 데이터(시간 기반 데이터)를 저장하고 분석하기 위한 타임 시리즈 데이터베이스로, IoT, 모니터링, DevOps 등 실시간 데이터 수집과 분석이 필요한 다양한 분야에서 활용됩니다. InfluxDB는 데이터를 효율적으로 저장하고 빠르게 읽어낼 수 있도록 최적화되어 있으며, 보존 정책과 고급 쿼리 기능을 통해 시계열 데이터 관리에 유리합니다.

---

== 1. InfluxDB의 주요 기능과 특징

=== 1.1 데이터 구조 및 저장 방식

InfluxDB는 시계열 데이터 특화된 구조로 데이터를 저장하며, 타임스탬프와 필드를 기준으로 데이터를 관리합니다.

* **타임스탬프**: 각 데이터 포인트가 기록된 시간 정보입니다. 모든 데이터는 타임스탬프를 기준으로 정렬되며, 시간 흐름에 따른 데이터를 빠르게 조회할 수 있습니다.
* **메asurement**: 관계형 데이터베이스의 테이블과 유사한 개념으로, 각 데이터의 그룹을 나타냅니다. 예를 들어, 센서 데이터를 수집하는 경우 `temperature`와 `humidity`와 같은 메저먼트를 생성할 수 있습니다.
* **태그(tag)**: 각 데이터에 부여된 메타데이터로, 쿼리 최적화와 데이터 필터링에 활용됩니다. 예를 들어, `location` 또는 `sensor_id`와 같은 태그를 사용하여 데이터를 그룹화할 수 있습니다.
* **필드(field)**: 저장되는 실제 데이터 값입니다. 예를 들어, 온도 데이터에서 온도 값을 `field`로 저장할 수 있습니다. 태그와 달리 필드는 인덱스가 생성되지 않아 쿼리 성능에 영향을 덜 미칩니다.

=== 1.2 데이터 수집 및 입력 방법

InfluxDB는 다양한 프로토콜과 방법을 통해 데이터를 수집할 수 있습니다.

* **HTTP API**: 간단한 HTTP POST 요청을 통해 데이터를 InfluxDB에 전송할 수 있습니다. 이 방법은 직접 RESTful API를 통해 데이터를 전송하기 때문에 설정이 쉽고 다양한 플랫폼에서 사용 가능합니다.
* **Telegraf**: InfluxDB의 데이터 수집 에이전트로, 다양한 플러그인을 통해 여러 소스에서 데이터를 자동으로 수집하고 변환하여 InfluxDB로 전송합니다. 예를 들어, 시스템 메트릭, IoT 장치 데이터, 로그 데이터를 InfluxDB로 수집할 때 유용합니다.
* **Influx CLI**: 터미널에서 직접 데이터를 입력하고 쿼리할 수 있는 명령줄 인터페이스입니다. 간단한 테스트나 데이터 입력 작업에 유용하게 사용됩니다.

=== 1.3 쿼리 언어: InfluxQL과 Flux

InfluxDB는 데이터를 분석하고 관리하기 위해 **InfluxQL**과 **Flux** 두 가지 쿼리 언어를 지원합니다.

* **InfluxQL**: SQL과 유사한 구문을 사용하며, 데이터 필터링, 집계, 시간 기반 계산 등의 작업을 쉽게 수행할 수 있습니다. 예를 들어, 특정 기간 동안의 평균 온도를 계산하는 쿼리를 작성할 수 있습니다.
* **Flux**: InfluxData에서 개발한 스크립팅 기반 쿼리 언어로, InfluxQL보다 고급 기능을 제공합니다. 데이터 필터링과 집계는 물론이고, 다른 데이터 소스와의 조인, 복잡한 분석, 조건부 로직 등을 포함할 수 있어 데이터 분석에 유연성을 더해줍니다.

=== 1.4 데이터 보존 및 수명 주기 관리

시간 기반 데이터는 빠르게 증가하기 때문에 오래된 데이터를 효율적으로 관리하기 위해 **보존 정책(Retention Policy)** 기능을 제공합니다.

* **Retention Policy**: 데이터를 저장하는 기간을 지정할 수 있으며, 지정된 기간이 지나면 데이터가 자동으로 삭제됩니다. 예를 들어, 데이터 보존 기간을 30일로 설정하면, 30일이 지난 데이터는 자동으로 삭제되어 저장 공간을 절약할 수 있습니다.
* **Continuous Queries**: 데이터가 계속 누적되는 환경에서 데이터 집계를 자동화하는 쿼리로, InfluxDB가 주기적으로 실행하여 데이터를 요약하거나 다른 메저먼트에 저장합니다. 이 기능을 사용하여 오래된 데이터는 요약하고 중요한 정보만 남기는 방식으로 관리할 수 있습니다.

=== 1.5 시계열 데이터의 고급 분석

InfluxDB는 시계열 데이터 분석에 유용한 다양한 함수를 제공하여 데이터를 효율적으로 처리하고 분석할 수 있습니다.

* **집계 함수**: `MEAN()`, `SUM()`, `MIN()`, `MAX()`와 같은 함수를 통해 시간 기반 데이터의 평균값, 합계, 최소값, 최대값을 계산할 수 있습니다.
* **윈도우 함수**: 데이터를 일정 시간 단위로 그룹화하여 분석할 수 있습니다. 예를 들어, 10분마다 온도의 평균값을 계산하여 온도의 변화를 추적할 수 있습니다.
* **파생 데이터 계산**: `DIFFERENCE()`와 같은 함수를 통해 시간 흐름에 따른 데이터 변화를 계산하여 데이터의 변화율을 확인할 수 있습니다. 예를 들어, 전력 사용량의 변화량을 분석하는 데 유용합니다.

=== 1.6 알림 설정 및 모니터링

InfluxDB는 **Kapacitor**라는 데이터 처리 및 경고 관리 도구와 통합하여, 실시간으로 데이터 상태를 모니터링하고 특정 조건이 충족될 때 경고를 설정할 수 있습니다.

* **Kapacitor와 연동**: InfluxDB에서 실시간으로 데이터 조건을 감시하고, 특정 임계치나 패턴이 발생할 경우 이메일, Slack, Webhook 등으로 알림을 받을 수 있습니다.
* **Alert Rules**: Kapacitor를 통해 설정된 경고 규칙에 따라 자동화된 알림을 설정하여 운영 효율성을 높이고, 이상 상황에 빠르게 대응할 수 있습니다.

== 2. InfluxDB를 활용한 데이터 저장 예시: IoT 센서 데이터 모니터링

1. **데이터 구조 설정**:
** 온도와 습도 센서 데이터를 저장하기 위해 `measurement`를 `sensor_data`로 지정하고, `location`을 태그로 사용하여 위치별로 데이터를 구분합니다.
** 필드는 `temperature`와 `humidity`로 설정하여 각 센서의 데이터를 저장합니다.

2. **데이터 수집 및 입력**:
** **Telegraf**를 사용해 MQTT 프로토콜을 통해 수집된 센서 데이터를 InfluxDB에 자동으로 전송합니다.
** HTTP API를 통해 직접 데이터를 전송하거나, Influx CLI로 간단한 테스트 데이터를 입력하여 데이터 구조를 확인할 수도 있습니다.

3. **데이터 쿼리와 분석**:
** InfluxQL을 사용해 특정 시간대의 평균 온도를 계산하거나, Flux를 사용해 여러 위치의 데이터를 조합해 시계열 분석을 수행합니다.
** `SELECT MEAN(temperature) FROM sensor_data WHERE location='Room1' AND time > now() - 1h`와 같이 쿼리를 작성하여 최근 1시간 동안의 평균 온도를 조회할 수 있습니다.

4. **데이터 보존 관리**:
** 보존 정책을 통해 데이터 저장 기간을 30일로 설정하고, 그 이후의 데이터는 자동으로 삭제되도록 합니다.
** 필요한 경우, Continuous Query를 설정하여 오래된 데이터는 1일 단위로 요약하여 저장하며, 장기적인 데이터 분석에 필요한 중요한 데이터만 남깁니다.

5. **경고 설정**:
** Kapacitor와 연동하여 특정 온도가 임계치를 초과할 경우 즉시 경고 알림을 전송하도록 설정합니다. 예를 들어, `temperature`가 80°C를 초과하면 관리자에게 Slack 알림을 보내도록 설정할 수 있습니다.


== 3. 정리

* InfluxDB는 시계열 데이터 관리에 강력한 기능을 제공하여 실시간 데이터의 효율적인 저장과 관리를 가능하게 하며, Telegraf, Kapacitor 등과의 연동을 통해 데이터 수집과 모니터링 환경을 강화할 수 있습니다.
* InfluxDB는 특히 빠른 쓰기 성능과 유연한 쿼리 기능을 통해 다양한 분야의 실시간 데이터 저장소로 활용될 수 있습니다.

---

[cols="1a,1a,1a",grid=none,frame=none]
|===
<s|link:section_7_2.adoc[이전 섹션]
^s|link:../../README.md[목차]
>s|link:../ch08/section_8_1.adoc[다음 섹션]
|===