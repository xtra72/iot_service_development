= 오픈 소스 소프트웨어를 활용한 데이터 저장

오픈 소스 소프트웨어를 활용한 **데이터 저장**은 시간 기반으로 수집된 데이터를 효과적으로 저장하고, 이후 분석과 모니터링에 사용할 수 있도록 하는 것이 목표입니다. 이를 위해 주로 타임 시리즈 데이터베이스와 NoSQL 데이터베이스를 활용하여 데이터를 관리하고, 데이터의 수명 주기와 효율적인 보존 관리를 통해 장기적 분석이 가능하도록 설계합니다.

---

== 1. 데이터 저장 구성 요소 및 데이터베이스 선택

=== 1.1 타임 시리즈 데이터베이스 (Time-Series Database)

시간 기반 데이터를 저장하는데 최적화된 **타임 시리즈 데이터베이스(TSDB)**는 IoT 센서 데이터, 로그, 모니터링 메트릭처럼 시간에 따라 수집되는 데이터 관리에 가장 유용합니다. TSDB는 시간 단위로 데이터를 집계 및 분석할 수 있어 빠르고 효율적인 시간 기반 분석이 가능합니다.

* **InfluxDB**
** **특징**: 타임스탬프와 키-값 쌍을 사용해 시간 기반 데이터를 효율적으로 저장합니다. 데이터 압축과 빠른 쓰기 성능을 지원하며, 특정 기간이 지난 데이터를 자동으로 삭제하는 보존 정책(Retention Policy)을 통해 저장 공간을 관리할 수 있습니다.
** **쿼리 언어**: InfluxQL과 Flux를 통해 시간 기반 쿼리와 통계 분석을 할 수 있으며, Flux를 사용하면 복잡한 쿼리도 쉽게 처리할 수 있습니다.
** **활용 예시**: IoT 센서에서 들어오는 온도, 습도, 기압 데이터를 실시간으로 저장하여 이후 온도 변화 패턴이나 트렌드를 분석하는 데 활용됩니다.

* **TimescaleDB**
** **특징**: PostgreSQL 위에 구축된 확장형 시계열 데이터베이스로, 일반 SQL 쿼리를 사용해 시계열 데이터를 다룰 수 있습니다. PostgreSQL의 기능을 그대로 사용하면서도, 시계열 데이터의 자동 분할 및 압축 기능을 제공합니다.
** **쿼리 기능**: 기본 SQL 쿼리로 시간 기반 데이터를 조회할 수 있어 기존 SQL 환경과의 호환성이 높습니다. **Continuous Aggregates** 기능을 통해 데이터 집계를 자동화하고 오래된 데이터를 요약 저장할 수 있습니다.
** **활용 예시**: 웹 서버 로그 데이터를 시간대별로 수집하여 트래픽 분석이나 특정 이벤트 발생 시점의 로그 패턴을 파악할 수 있습니다.

=== 1.2 NoSQL 데이터베이스

**NoSQL 데이터베이스**는 구조화된 정형 데이터뿐만 아니라 다양한 형태의 비정형 데이터를 저장하고 관리하는 데 효과적입니다. 특히 수평적 확장이 용이하여, 실시간으로 대용량 데이터를 분산 저장할 때 유리합니다.

* **MongoDB**
** **특징**: JSON과 유사한 BSON 포맷으로 데이터를 저장하는 문서 기반 데이터베이스입니다. 유연한 데이터 구조를 지원해 다양한 필드와 값을 쉽게 추가할 수 있으며, 복잡한 데이터 구조에도 대응 가능합니다.
** **분석 기능**: Aggregation Pipeline을 통해 시간 기반 집계와 분석이 가능하며, 대규모 데이터에서 특정 시간대의 이벤트나 로그 패턴을 분석하는 데 유리합니다.
** **활용 예시**: IoT 장치 이벤트 로그나 사용자 활동 데이터를 시간대별로 저장해 이벤트 발생 빈도와 패턴을 파악하는 데 사용됩니다.

* **Cassandra**
** **특징**: 분산된 환경에서도 높은 쓰기 성능과 확장성을 제공하는 컬럼 패밀리 기반의 데이터베이스로, 대규모 데이터 처리에 적합합니다. 각 노드가 독립적으로 작동하여 고가용성을 보장합니다.
** **분석 기능**: Apache Spark와의 통합을 통해 대용량 데이터를 빠르게 분석할 수 있습니다. TTL(Time To Live) 설정을 통해 특정 기간이 지난 데이터는 자동으로 삭제할 수 있습니다.
** **활용 예시**: 실시간으로 발생하는 IoT 이벤트 데이터를 시간순으로 저장하여, 각 이벤트가 발생한 시간과 빈도를 추적하고 특정 상황을 분석하는 데 사용됩니다.

---

== 1.3 데이터 저장을 위한 데이터 파이프라인 구성 (Node-RED, Telegraf 등)

**데이터 파이프라인 도구**는 데이터 수집부터 저장에 이르는 일련의 과정을 관리하고 자동화합니다. 다양한 소스에서 수집된 데이터가 타임 시리즈나 NoSQL 데이터베이스에 효율적으로 저장될 수 있도록 구성합니다.

* **Node-RED**:
** **역할**: 실시간 데이터 흐름을 시각적으로 구성하여 다양한 소스에서 수집된 데이터를 중간에서 필터링, 변환, 보강하고, 여러 데이터베이스로 전송합니다.
** **활용 예시**: Node-RED를 통해 MQTT로 전송되는 센서 데이터를 수집하고, 타임스탬프를 추가한 후 InfluxDB나 MongoDB에 저장합니다.

* **Telegraf**:
** **역할**: InfluxData에서 제공하는 경량 데이터 수집 에이전트로, 다양한 플러그인을 통해 시스템 메트릭과 IoT 장치 데이터를 수집하여 타임 시리즈 데이터베이스에 직접 저장합니다.
** **활용 예시**: CPU 온도, 메모리 사용량 등의 시스템 메트릭을 수집해 InfluxDB로 전송하여 장기적인 모니터링과 분석에 사용할 수 있습니다.

* **Apache NiFi**:
** **역할**: 실시간 데이터 전송을 위한 시각적 인터페이스를 제공하여 다양한 데이터 소스와 데이터베이스 간에 데이터를 이동, 변환, 필터링하는 역할을 수행합니다.
** **활용 예시**: 센서에서 수집된 데이터를 NiFi로 전달받아 필요에 따라 형식을 변환한 후 InfluxDB나 MongoDB에 저장합니다.

---

== 1.4 데이터 보존 및 수명 주기 관리 (Data Retention and Lifecycle Management)

실시간 데이터는 시간이 지남에 따라 데이터 양이 빠르게 증가하기 때문에, 오래된 데이터를 효율적으로 관리하여 저장 공간을 최적화하는 것이 중요합니다. 각 데이터베이스의 보존 정책과 데이터 관리 기능을 활용해 데이터를 축약 저장하거나 자동 삭제할 수 있습니다.

* **InfluxDB의 Retention Policy**: 데이터 보존 정책을 설정하여 일정 기간이 지난 데이터를 자동으로 삭제할 수 있습니다. 예를 들어, 30일 동안만 데이터를 유지하고 그 이후는 삭제하여 저장소 공간을 절약할 수 있습니다.

* **TimescaleDB의 Continuous Aggregates**: 오래된 데이터를 요약하여 저장함으로써, 주요 정보는 유지하면서도 저장 공간을 절감할 수 있습니다.

* **Cassandra의 TTL(Time To Live)**: 데이터를 저장할 때 TTL을 설정하여 지정된 시간이 지나면 데이터를 자동으로 삭제합니다. 이 방식으로 데이터 저장 공간을 효율적으로 관리할 수 있습니다.

== 2. 데이터 저장 구성 예시: 스마트 팩토리의 센서 데이터 저장

1. **데이터 저장소 설정**:
** 실시간으로 수집되는 온도, 진동 등의 센서 데이터를 InfluxDB에 저장하여 시간 기반 분석과 모니터링을 수행합니다.

2. **데이터 파이프라인 구성**:
** 센서 데이터는 MQTT를 통해 Node-RED로 전송되고, Node-RED에서 데이터의 타임스탬프와 필수 정보를 보강하여 InfluxDB에 적재합니다. 시스템 메트릭 데이터는 Telegraf로 수집하여 동일한 InfluxDB로 전송됩니다.

3. **데이터 수명 주기 관리**:
** InfluxDB 보존 정책을 통해 60일 동안 데이터를 유지하고, 그 이후의 데이터는 삭제하거나 요약 저장해 장기 분석에 필요한 주요 정보만 보존합니다.

4. **데이터 분석 준비**:
** TimescaleDB에 저장된 이벤트 로그와 InfluxDB의 시계열 데이터를 함께 분석하여, 특정 이벤트가 발생한 시점의 센서 데이터를 확인하고, 이상 패턴을 예측하는 데 활용합니다.

== 3. 정리

* 오픈 소스 소프트웨어를 통한 실시간 데이터 저장 구성은 시간 기반으로 수집된 데이터를 **타임 시리즈 데이터베이스**와 **NoSQL 데이터베이스**에 효율적으로 저장하고 분석할 수 있도록 합니다.

* **InfluxDB**는 빠른 쓰기 성능과 보존 정책을 통해 장기 데이터 관리에 유리하고, **TimescaleDB**는 PostgreSQL 기반으로 SQL 쿼리와 집계를 지원해 복잡한 분석에 적합합니다.

* **Node-RED**와 **Telegraf**는 다양한 데이터 소스에서 데이터를 수집하고 전송하며, 데이터의 필터링과 보강을 수행합니다.

* 오래된 데이터는 InfluxDB의 보존 정책이나 TimescaleDB의 Continuous Aggregates 기능으로 효율적으로 관리하여 저장 공간을 절감하고, 장기적인 분석을 가능하게 합니다.

---

[cols="1a,1a,1a",grid=none,frame=none]
|===
<s|link:../ch06/section_6_2.adoc[이전 섹션]
^s|link:../../README.md[목차]
>s|link:section_7_2.adoc[다음 섹션]
|===